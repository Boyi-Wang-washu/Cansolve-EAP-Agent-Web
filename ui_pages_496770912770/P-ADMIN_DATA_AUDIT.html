<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Audit - BNBU EAP English Teaching Assistant</title>
    <script src="https://unpkg.byted-static.com/coze/space_ppt_lib/1.0.3-alpha.12/lib/tailwindcss.js"></script>
    <script src="https://unpkg.byted-static.com/fortawesome/fontawesome-free/6.7.2/js/all.min.js" data-auto-replace-svg="nest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1B8C79',
                        secondary: '#37436A', 
                        accent: '#080D1E',
                        'text-primary': '#1F2937',
                        'text-secondary': '#6B7280',
                        'bg-light': '#F9FAFB',
                        'border-light': '#E5E7EB'
                    },
                    boxShadow: {
                        'card': '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)',
                        'card-hover': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)'
                    }
                }
            }
        }
    </script>
    <style>
        .sidebar-transition {
            transition: width 0.3s ease-in-out;
        }
        
        .card-hover:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transform: translateY(-1px);
            transition: all 0.2s ease-in-out;
        }
        
        .nav-item-active {
            background-color: rgba(27, 140, 121, 0.1);
            border-right: 3px solid #1B8C79;
            color: #1B8C79;
        }
        
        .table-row:hover {
            background-color: #F9FAFB;
        }
        
        .sortable:hover {
            color: #1B8C79;
            cursor: pointer;
        }
        
        .filter-dropdown {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }
        
        .filter-dropdown.show {
            max-height: 200px;
        }
    </style>
</head>
<body class="bg-bg-light min-h-screen">
    <!-- Top Navigation Bar -->
    <header id="top-nav" class="fixed top-0 left-0 right-0 bg-white border-b border-border-light h-16 z-50">
        <div class="flex items-center justify-between h-full px-6">
            <!-- Logo and Brand -->
            <div id="brand-section" class="flex items-center space-x-4">
                <div id="logo" class="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
                    <i class="fas fa-graduation-cap text-white text-lg"></i>
                </div>
                <div>
                    <h1 id="brand-title" class="text-xl font-bold text-text-primary">BNBU EAP</h1>
                    <p id="brand-subtitle" class="text-xs text-text-secondary">English Teaching Assistant</p>
                </div>
            </div>
            
            <!-- Search Bar -->
            <div id="search-section" class="flex-1 max-w-md mx-8">
                <div class="relative">
                    <input 
                        type="text" 
                        id="global-search" 
                        placeholder="Search materials, sessions..." 
                        class="w-full pl-10 pr-4 py-2 border border-border-light rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                    >
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-text-secondary"></i>
                </div>
            </div>
            
            <!-- User Actions -->
            <div id="user-actions" class="flex items-center space-x-4">
                <!-- Notifications -->
                <button id="notifications-btn" class="relative p-2 text-text-secondary hover:text-primary transition-colors">
                    <i class="fas fa-bell text-lg"></i>
                    <span class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"></span>
                </button>
                
                <!-- User Profile -->
                <div id="user-profile" class="relative">
                    <button id="user-menu-btn" class="flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-50 transition-colors">
                        <img 
                            src="https://s.coze.cn/image/muAAu_IGjyQ/" 
                            alt="Admin Avatar" 
                            class="w-8 h-8 rounded-full"
                            data-category="人物"
                        >
                        <span class="text-sm font-medium text-text-primary">Admin User</span>
                        <i class="fas fa-chevron-down text-xs text-text-secondary"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <aside id="sidebar" class="fixed left-0 top-16 bottom-0 w-64 bg-white border-r border-border-light sidebar-transition z-40">
        <nav id="sidebar-nav" class="p-4 space-y-2">
            <!-- Dashboard -->
            <a href="P-ENTRY.html" id="nav-dashboard" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium text-text-secondary hover:bg-gray-50 hover:text-primary transition-colors">
                <i class="fas fa-home w-5"></i>
                <span>Dashboard</span>
            </a>
            
            <!-- Admin Section -->
            <div id="admin-section" class="mt-8 pt-4 border-t border-border-light">
                <h3 class="px-4 text-xs font-semibold text-text-secondary uppercase tracking-wider mb-3">Admin Tools</h3>
                <a href="P-ADMIN_USER_MANAGE.html" id="nav-users" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium text-text-secondary hover:bg-gray-50 hover:text-primary transition-colors">
                    <i class="fas fa-users-cog w-5"></i>
                    <span>User Management</span>
                </a>
                <a href="P-ADMIN_SYSTEM_CONFIG.html" id="nav-config" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium text-text-secondary hover:bg-gray-50 hover:text-primary transition-colors">
                    <i class="fas fa-cog w-5"></i>
                    <span>System Configuration</span>
                </a>
                <a href="P-ADMIN_DATA_AUDIT.html" id="nav-audit" class="nav-item-active flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors">
                    <i class="fas fa-shield-alt w-5"></i>
                    <span>Data Audit</span>
                </a>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main id="main-content" class="ml-64 mt-16 p-8 min-h-screen">
        <!-- Page Header -->
        <div id="page-header" class="mb-8">
            <nav id="breadcrumb" class="text-sm text-text-secondary mb-2">
                <span>Home</span>
                <i class="fas fa-chevron-right mx-2"></i>
                <span>Admin Tools</span>
                <i class="fas fa-chevron-right mx-2"></i>
                <span>Data Audit</span>
            </nav>
            <h1 id="page-title" class="text-3xl font-bold text-text-primary mb-2">Data Audit</h1>
            <p id="page-subtitle" class="text-text-secondary">View system operation logs and perform data auditing</p>
        </div>

        <!-- Toolbar -->
        <div id="toolbar" class="bg-white rounded-xl shadow-card p-6 mb-6">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">
                <!-- Time Range and Filters -->
                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                    <!-- Time Range Selector -->
                    <div class="relative">
                        <label for="time-range" class="block text-sm font-medium text-text-primary mb-2">Time Range</label>
                        <select id="time-range" class="w-full sm:w-48 px-4 py-2 border border-border-light rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="today">Today</option>
                            <option value="week" selected>Last 7 days</option>
                            <option value="month">Last 30 days</option>
                            <option value="quarter">Last 3 months</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </div>

                    <!-- Operation Type Filter -->
                    <div class="relative">
                        <label for="operation-type" class="block text-sm font-medium text-text-primary mb-2">Operation Type</label>
                        <button id="operation-type-btn" class="w-full sm:w-48 px-4 py-2 border border-border-light rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-left flex items-center justify-between">
                            <span id="operation-type-text">All Types</span>
                            <i class="fas fa-chevron-down text-text-secondary"></i>
                        </button>
                        <div id="operation-type-dropdown" class="filter-dropdown absolute top-full left-0 right-0 mt-1 bg-white border border-border-light rounded-lg shadow-lg z-10">
                            <div class="p-2">
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" class="operation-type-checkbox" value="login" checked>
                                    <span class="ml-2">Login</span>
                                </label>
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" class="operation-type-checkbox" value="logout" checked>
                                    <span class="ml-2">Logout</span>
                                </label>
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" class="operation-type-checkbox" value="upload" checked>
                                    <span class="ml-2">File Upload</span>
                                </label>
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" class="operation-type-checkbox" value="download" checked>
                                    <span class="ml-2">File Download</span>
                                </label>
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" class="operation-type-checkbox" value="create" checked>
                                    <span class="ml-2">Create</span>
                                </label>
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" class="operation-type-checkbox" value="update" checked>
                                    <span class="ml-2">Update</span>
                                </label>
                                <label class="flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer">
                                    <input type="checkbox" class="operation-type-checkbox" value="delete" checked>
                                    <span class="ml-2">Delete</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- User Filter -->
                    <div class="relative">
                        <label for="user-filter" class="block text-sm font-medium text-text-primary mb-2">User</label>
                        <input 
                            type="text" 
                            id="user-filter" 
                            placeholder="Filter by username..." 
                            class="w-full sm:w-48 px-4 py-2 border border-border-light rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                        >
                    </div>
                </div>

                <!-- Export Button -->
                <div class="flex items-center space-x-4">
                    <button id="export-btn" class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90 transition-colors flex items-center space-x-2">
                        <i class="fas fa-download"></i>
                        <span>Export Logs</span>
                    </button>
                    <button id="refresh-btn" class="px-4 py-2 border border-border-light text-text-primary rounded-lg hover:bg-gray-50 transition-colors">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Audit Logs Table -->
        <div id="audit-logs-container" class="bg-white rounded-xl shadow-card overflow-hidden">
            <!-- Table Header -->
            <div class="px-6 py-4 border-b border-border-light">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-text-primary">Audit Logs</h3>
                    <div class="text-sm text-text-secondary">
                        Showing <span id="showing-count">1-10</span> of <span id="total-count">156</span> entries
                    </div>
                </div>
            </div>

            <!-- Table -->
            <div class="overflow-x-auto">
                <table id="audit-logs-table" class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider sortable" data-sort="timestamp">
                                <div class="flex items-center space-x-1">
                                    <span>Operation Time</span>
                                    <i class="fas fa-sort text-xs"></i>
                                </div>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider sortable" data-sort="user">
                                <div class="flex items-center space-x-1">
                                    <span>User</span>
                                    <i class="fas fa-sort text-xs"></i>
                                </div>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider sortable" data-sort="operation">
                                <div class="flex items-center space-x-1">
                                    <span>Operation Type</span>
                                    <i class="fas fa-sort text-xs"></i>
                                </div>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider">
                                Operation Details
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider sortable" data-sort="ip">
                                <div class="flex items-center space-x-1">
                                    <span>IP Address</span>
                                    <i class="fas fa-sort text-xs"></i>
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="audit-logs-tbody" class="bg-white divide-y divide-gray-200">
                        <!-- Log entries will be dynamically populated -->
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div id="pagination" class="px-6 py-4 border-t border-border-light flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-text-secondary">Show</span>
                    <select id="page-size" class="border border-border-light rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-primary">
                        <option value="10">10</option>
                        <option value="25">25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                    <span class="text-sm text-text-secondary">entries per page</span>
                </div>
                
                <div class="flex items-center space-x-2">
                    <button id="prev-page" class="px-3 py-1 border border-border-light rounded text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div id="page-numbers" class="flex items-center space-x-1">
                        <!-- Page numbers will be dynamically populated -->
                    </div>
                    <button id="next-page" class="px-3 py-1 border border-border-light rounded text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Mock audit log data
            const mockAuditLogs = [
                {
                    id: 1,
                    timestamp: '2024-01-15 14:30:25',
                    user: 'john.doe@bnbu.edu',
                    operation: 'login',
                    details: 'User successfully logged in',
                    ip: '192.168.1.100'
                },
                {
                    id: 2,
                    timestamp: '2024-01-15 14:28:12',
                    user: 'jane.smith@bnbu.edu',
                    operation: 'upload',
                    details: 'Uploaded material: ENG-2025-U3-A.pdf',
                    ip: '192.168.1.105'
                },
                {
                    id: 3,
                    timestamp: '2024-01-15 14:25:45',
                    user: 'admin@bnbu.edu',
                    operation: 'create',
                    details: 'Created new user account: mike.johnson@bnbu.edu',
                    ip: '192.168.1.200'
                },
                {
                    id: 4,
                    timestamp: '2024-01-15 14:22:30',
                    user: 'alex.wang@bnbu.edu',
                    operation: 'logout',
                    details: 'User logged out',
                    ip: '192.168.1.110'
                },
                {
                    id: 5,
                    timestamp: '2024-01-15 14:20:15',
                    user: 'sarah.brown@bnbu.edu',
                    operation: 'download',
                    details: 'Downloaded learning report: report_2024_01_15.pdf',
                    ip: '192.168.1.115'
                },
                {
                    id: 6,
                    timestamp: '2024-01-15 14:18:00',
                    user: 'john.doe@bnbu.edu',
                    operation: 'update',
                    details: 'Updated profile information',
                    ip: '192.168.1.100'
                },
                {
                    id: 7,
                    timestamp: '2024-01-15 14:15:30',
                    user: 'jane.smith@bnbu.edu',
                    operation: 'delete',
                    details: 'Deleted material: ENG-2024-U2-B.docx',
                    ip: '192.168.1.105'
                },
                {
                    id: 8,
                    timestamp: '2024-01-15 14:12:45',
                    user: 'admin@bnbu.edu',
                    operation: 'update',
                    details: 'Updated system configuration: file_upload_limit',
                    ip: '192.168.1.200'
                },
                {
                    id: 9,
                    timestamp: '2024-01-15 14:10:20',
                    user: 'mike.johnson@bnbu.edu',
                    operation: 'login',
                    details: 'User successfully logged in',
                    ip: '192.168.1.120'
                },
                {
                    id: 10,
                    timestamp: '2024-01-15 14:08:15',
                    user: 'alex.wang@bnbu.edu',
                    operation: 'upload',
                    details: 'Uploaded material: ENG-2025-U4-C.pdf',
                    ip: '192.168.1.110'
                }
            ];

            let currentPage = 1;
            let pageSize = 10;
            let sortField = 'timestamp';
            let sortDirection = 'desc';
            let filteredLogs = [...mockAuditLogs];

            // Render audit logs table
            function renderAuditLogs() {
                const tbody = document.querySelector('#audit-logs-tbody');
                const startIndex = (currentPage - 1) * pageSize;
                const endIndex = startIndex + pageSize;
                const pageLogs = filteredLogs.slice(startIndex, endIndex);

                tbody.innerHTML = '';

                pageLogs.forEach(log => {
                    const row = document.createElement('tr');
                    row.className = 'table-row';
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-text-primary">
                            ${log.timestamp}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-text-primary">
                            ${log.user}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getOperationTypeClass(log.operation)}">
                                ${getOperationTypeName(log.operation)}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-sm text-text-primary max-w-xs truncate" title="${log.details}">
                            ${log.details}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-text-primary">
                            ${log.ip}
                        </td>
                    `;
                    tbody.appendChild(row);
                });

                updatePagination();
                updateShowingCount();
            }

            // Get operation type class for styling
            function getOperationTypeClass(operation) {
                const classes = {
                    login: 'bg-green-100 text-green-800',
                    logout: 'bg-gray-100 text-gray-800',
                    upload: 'bg-blue-100 text-blue-800',
                    download: 'bg-purple-100 text-purple-800',
                    create: 'bg-green-100 text-green-800',
                    update: 'bg-yellow-100 text-yellow-800',
                    delete: 'bg-red-100 text-red-800'
                };
                return classes[operation] || 'bg-gray-100 text-gray-800';
            }

            // Get operation type display name
            function getOperationTypeName(operation) {
                const names = {
                    login: 'Login',
                    logout: 'Logout',
                    upload: 'File Upload',
                    download: 'File Download',
                    create: 'Create',
                    update: 'Update',
                    delete: 'Delete'
                };
                return names[operation] || operation;
            }

            // Update pagination
            function updatePagination() {
                const totalPages = Math.ceil(filteredLogs.length / pageSize);
                const pageNumbers = document.querySelector('#page-numbers');
                
                pageNumbers.innerHTML = '';
                
                for (let i = 1; i <= totalPages; i++) {
                    if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                        const button = document.createElement('button');
                        button.className = `px-3 py-1 border rounded text-sm ${i === currentPage ? 'bg-primary text-white border-primary' : 'border-border-light hover:bg-gray-50'}`;
                        button.textContent = i;
                        button.addEventListener('click', () => {
                            currentPage = i;
                            renderAuditLogs();
                        });
                        pageNumbers.appendChild(button);
                    } else if (i === currentPage - 2 || i === currentPage + 2) {
                        const ellipsis = document.createElement('span');
                        ellipsis.className = 'px-2 text-text-secondary';
                        ellipsis.textContent = '...';
                        pageNumbers.appendChild(ellipsis);
                    }
                }

                // Update prev/next buttons
                document.querySelector('#prev-page').disabled = currentPage === 1;
                document.querySelector('#next-page').disabled = currentPage === totalPages;
            }

            // Update showing count
            function updateShowingCount() {
                const startIndex = (currentPage - 1) * pageSize + 1;
                const endIndex = Math.min(currentPage * pageSize, filteredLogs.length);
                document.querySelector('#showing-count').textContent = `${startIndex}-${endIndex}`;
                document.querySelector('#total-count').textContent = filteredLogs.length;
            }

            // Sort logs
            function sortLogs(field) {
                if (sortField === field) {
                    sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    sortField = field;
                    sortDirection = 'desc';
                }

                filteredLogs.sort((a, b) => {
                    let aValue = a[field];
                    let bValue = b[field];

                    if (field === 'timestamp') {
                        aValue = new Date(aValue);
                        bValue = new Date(bValue);
                    }

                    if (sortDirection === 'asc') {
                        return aValue > bValue ? 1 : -1;
                    } else {
                        return aValue < bValue ? 1 : -1;
                    }
                });

                renderAuditLogs();
                updateSortIcons();
            }

            // Update sort icons
            function updateSortIcons() {
                document.querySelectorAll('.sortable i').forEach(icon => {
                    icon.className = 'fas fa-sort text-xs';
                });

                const activeSort = document.querySelector(`[data-sort="${sortField}"] i`);
                if (activeSort) {
                    activeSort.className = `fas fa-sort-${sortDirection === 'asc' ? 'up' : 'down'} text-xs`;
                }
            }

            // Filter logs
            function filterLogs() {
                const timeRange = document.querySelector('#time-range').value;
                const userFilter = document.querySelector('#user-filter').value.toLowerCase();
                const selectedOperations = Array.from(document.querySelectorAll('.operation-type-checkbox:checked'))
                    .map(cb => cb.value);

                filteredLogs = mockAuditLogs.filter(log => {
                    // Filter by user
                    if (userFilter && !log.user.toLowerCase().includes(userFilter)) {
                        return false;
                    }

                    // Filter by operation type
                    if (!selectedOperations.includes(log.operation)) {
                        return false;
                    }

                    // Filter by time range (simplified for demo)
                    if (timeRange !== 'all') {
                        // In real implementation, would filter by actual date range
                        return true;
                    }

                    return true;
                });

                currentPage = 1;
                renderAuditLogs();
            }

            // Initialize page
            renderAuditLogs();
            updateSortIcons();

            // Event listeners
            document.querySelector('#time-range').addEventListener('change', filterLogs);
            document.querySelector('#user-filter').addEventListener('input', filterLogs);

            // Operation type filter dropdown
            document.querySelector('#operation-type-btn').addEventListener('click', function() {
                const dropdown = document.querySelector('#operation-type-dropdown');
                dropdown.classList.toggle('show');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                const dropdown = document.querySelector('#operation-type-dropdown');
                const button = document.querySelector('#operation-type-btn');
                if (!button.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.classList.remove('show');
                }
            });

            // Operation type checkboxes
            document.querySelectorAll('.operation-type-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const checkedBoxes = document.querySelectorAll('.operation-type-checkbox:checked');
                    const buttonText = document.querySelector('#operation-type-text');
                    
                    if (checkedBoxes.length === 7) {
                        buttonText.textContent = 'All Types';
                    } else if (checkedBoxes.length === 0) {
                        buttonText.textContent = 'No Types';
                    } else {
                        buttonText.textContent = `${checkedBoxes.length} Type(s)`;
                    }
                    
                    filterLogs();
                });
            });

            // Sortable headers
            document.querySelectorAll('.sortable').forEach(header => {
                header.addEventListener('click', function() {
                    const field = this.dataset.sort;
                    sortLogs(field);
                });
            });

            // Page size change
            document.querySelector('#page-size').addEventListener('change', function() {
                pageSize = parseInt(this.value);
                currentPage = 1;
                renderAuditLogs();
            });

            // Pagination buttons
            document.querySelector('#prev-page').addEventListener('click', function() {
                if (currentPage > 1) {
                    currentPage--;
                    renderAuditLogs();
                }
            });

            document.querySelector('#next-page').addEventListener('click', function() {
                const totalPages = Math.ceil(filteredLogs.length / pageSize);
                if (currentPage < totalPages) {
                    currentPage++;
                    renderAuditLogs();
                }
            });

            // Export button
            document.querySelector('#export-btn').addEventListener('click', function() {
                console.log('需要调用第三方接口实现日志导出功能');
                // 在实际应用中，这里会调用API导出日志
                alert('Export functionality would be implemented here');
            });

            // Refresh button
            document.querySelector('#refresh-btn').addEventListener('click', function() {
                filterLogs();
                this.classList.add('animate-spin');
                setTimeout(() => {
                    this.classList.remove('animate-spin');
                }, 1000);
            });

            // Navigation
            document.querySelector('#nav-dashboard').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'P-ENTRY.html';
            });

            document.querySelector('#nav-users').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'P-ADMIN_USER_MANAGE.html';
            });

            document.querySelector('#nav-config').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'P-ADMIN_SYSTEM_CONFIG.html';
            });

            document.querySelector('#nav-audit').addEventListener('click', function(e) {
                e.preventDefault();
                // Already on audit page
            });
        });
    </script>
</body>
</html>
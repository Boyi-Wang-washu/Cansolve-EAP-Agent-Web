<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1v1 Tutoring Chat - BNBU EAP English Teaching Assistant</title>
    <script src="https://unpkg.byted-static.com/coze/space_ppt_lib/1.0.3-alpha.12/lib/tailwindcss.js"></script>
    <script src="https://unpkg.byted-static.com/fortawesome/fontawesome-free/6.7.2/js/all.min.js" data-auto-replace-svg="nest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1B8C79',
                        secondary: '#37436A', 
                        accent: '#080D1E',
                        'text-primary': '#1F2937',
                        'text-secondary': '#6B7280',
                        'bg-light': '#F9FAFB',
                        'border-light': '#E5E7EB'
                    },
                    boxShadow: {
                        'card': '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)',
                        'card-hover': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)'
                    }
                }
            }
        }
    </script>
    <style>
        .sidebar-transition {
            transition: width 0.3s ease-in-out;
        }
        
        .card-hover:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transform: translateY(-1px);
            transition: all 0.2s ease-in-out;
        }
        
        .nav-item-active {
            background-color: rgba(27, 140, 121, 0.1);
            border-right: 3px solid #1B8C79;
            color: #1B8C79;
        }
        
        .chat-bubble-user {
            background-color: #1B8C79;
            color: white;
            border-radius: 18px 18px 4px 18px;
            margin-left: auto;
            margin-right: 0;
        }
        
        .chat-bubble-ai {
            background-color: #F3F4F6;
            color: #1F2937;
            border-radius: 18px 18px 18px 4px;
            margin-right: auto;
            margin-left: 0;
        }
        
        .typing-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #9CA3AF;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }
        
        .quick-action-btn {
            background-color: #F3F4F6;
            border: 1px solid #E5E7EB;
            transition: all 0.2s ease-in-out;
        }
        
        .quick-action-btn:hover {
            background-color: #E5E7EB;
            border-color: #D1D5DB;
        }
        
        .quick-action-btn:active {
            background-color: #D1D5DB;
        }
        
        .drawer-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        .drawer-enter {
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        
        .drawer-enter-active {
            transform: translateX(0);
        }
    </style>
</head>
<body class="bg-bg-light min-h-screen">
    <!-- Top Navigation Bar -->
    <header id="top-nav" class="fixed top-0 left-0 right-0 bg-white border-b border-border-light h-16 z-50">
        <div class="flex items-center justify-between h-full px-6">
            <!-- Logo and Brand -->
            <div id="brand-section" class="flex items-center space-x-4">
                <div id="logo" class="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
                    <i class="fas fa-graduation-cap text-white text-lg"></i>
                </div>
                <div>
                    <h1 id="brand-title" class="text-xl font-bold text-text-primary">BNBU EAP</h1>
                    <p id="brand-subtitle" class="text-xs text-text-secondary">English Teaching Assistant</p>
                </div>
            </div>
            
            <!-- Search Bar -->
            <div id="search-section" class="flex-1 max-w-md mx-8">
                <div class="relative">
                    <input 
                        type="text" 
                        id="global-search" 
                        placeholder="Search materials, sessions..." 
                        class="w-full pl-10 pr-4 py-2 border border-border-light rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                    >
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-text-secondary"></i>
                </div>
            </div>
            
            <!-- User Actions -->
            <div id="user-actions" class="flex items-center space-x-4">
                <!-- Notifications -->
                <button id="notifications-btn" class="relative p-2 text-text-secondary hover:text-primary transition-colors">
                    <i class="fas fa-bell text-lg"></i>
                    <span class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"></span>
                </button>
                
                <!-- User Profile -->
                <div id="user-profile" class="relative">
                    <button id="user-menu-btn" class="flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-50 transition-colors">
                        <img 
                            src="https://s.coze.cn/image/vdWnz30GSzE/" 
                            alt="User Avatar" 
                            class="w-8 h-8 rounded-full"
                            data-category="人物"
                        >
                        <span class="text-sm font-medium text-text-primary">John Doe</span>
                        <i class="fas fa-chevron-down text-xs text-text-secondary"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <aside id="sidebar" class="fixed left-0 top-16 bottom-0 w-64 bg-white border-r border-border-light sidebar-transition z-40">
        <nav id="sidebar-nav" class="p-4 space-y-2">
            <!-- Dashboard -->
            <a href="P-ENTRY.html" id="nav-dashboard" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium text-text-secondary hover:bg-gray-50 hover:text-primary transition-colors">
                <i class="fas fa-home w-5"></i>
                <span>Dashboard</span>
            </a>
            
            <!-- 1v1 Tutoring -->
            <a href="#" id="nav-tutoring" class="nav-item-active flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors">
                <i class="fas fa-comments w-5"></i>
                <span>1v1 Tutoring</span>
            </a>
            
            <!-- Group Discussion -->
            <a href="#" id="nav-group" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium text-text-secondary hover:bg-gray-50 hover:text-primary transition-colors">
                <i class="fas fa-users w-5"></i>
                <span>Group Discussion</span>
                <span class="ml-auto px-2 py-1 bg-gray-100 text-xs text-gray-600 rounded-full">Coming Soon</span>
            </a>
            
            <!-- Video Feedback -->
            <a href="#" id="nav-video" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium text-text-secondary hover:bg-gray-50 hover:text-primary transition-colors">
                <i class="fas fa-video w-5"></i>
                <span>Video Feedback</span>
                <span class="ml-auto px-2 py-1 bg-gray-100 text-xs text-gray-600 rounded-full">Coming Soon</span>
            </a>
            
            <!-- Learning Reports -->
            <a href="P-REPORT.html" id="nav-reports" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium text-text-secondary hover:bg-gray-50 hover:text-primary transition-colors">
                <i class="fas fa-chart-line w-5"></i>
                <span>Learning Reports</span>
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main id="main-content" class="ml-64 mt-16 flex flex-col h-screen">
        <!-- Page Header -->
        <div id="page-header" class="bg-white border-b border-border-light px-6 py-4">
            <div class="flex items-center justify-between">
                <div>
                    <nav id="breadcrumb" class="text-sm text-text-secondary mb-1">
                        <span>Home</span>
                        <span class="mx-2">/</span>
                        <span>1v1 Tutoring</span>
                        <span class="mx-2">/</span>
                        <span>Chat</span>
                    </nav>
                    <h1 id="page-title" class="text-xl font-semibold text-text-primary">1v1 Tutoring Chat</h1>
                    <p id="page-subtitle" class="text-sm text-text-secondary">Material: ENG-2025-U3-A - "The Future of Education"</p>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="material-info-btn" class="px-4 py-2 text-sm border border-border-light rounded-lg hover:bg-gray-50 transition-colors">
                        <i class="fas fa-file-alt mr-2"></i>
                        Material Info
                    </button>
                    <button id="session-summary-btn" class="px-4 py-2 text-sm border border-border-light rounded-lg hover:bg-gray-50 transition-colors">
                        <i class="fas fa-chart-line mr-2"></i>
                        Session Summary
                    </button>
                </div>
            </div>
        </div>

        <!-- Chat Area -->
        <div id="chat-container" class="flex-1 flex flex-col bg-white">
            <!-- Chat Messages -->
            <div id="chat-messages" class="flex-1 p-6 overflow-y-auto space-y-4">
                <!-- Welcome Message -->
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-robot text-white text-sm"></i>
                    </div>
                    <div class="chat-bubble-ai max-w-md p-4">
                        <p class="text-sm">Welcome to your 1v1 tutoring session! I've prepared the material "The Future of Education" for our discussion. Would you like to start by summarizing the main ideas, or shall we dive into specific sections?</p>
                    </div>
                </div>

                <!-- User Message -->
                <div class="flex items-start space-x-3 justify-end">
                    <div class="chat-bubble-user max-w-md p-4">
                        <p class="text-sm">I'd like to start by discussing the main ideas. The article talks about how technology is changing education, right?</p>
                    </div>
                    <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center flex-shrink-0">
                        <img 
                            src="https://s.coze.cn/image/bjx8jtmIE88/" 
                            alt="User Avatar" 
                            class="w-full h-full rounded-full object-cover"
                            data-category="人物"
                        >
                    </div>
                </div>

                <!-- AI Response with Grammar Correction -->
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-robot text-white text-sm"></i>
                    </div>
                    <div class="flex-1 max-w-md">
                        <div class="chat-bubble-ai p-4 mb-2">
                            <p class="text-sm mb-3">That's correct! The article explores several key transformations:</p>
                            <ul class="text-sm space-y-1">
                                <li>• Personalized learning through AI algorithms</li>
                                <li>• Blended learning environments</li>
                                <li>• Lifelong learning models</li>
                            </ul>
                        </div>
                        <!-- Grammar Correction -->
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-3 rounded-r">
                            <div class="flex items-center space-x-2 mb-1">
                                <i class="fas fa-lightbulb text-yellow-600 text-sm"></i>
                                <span class="text-xs font-medium text-yellow-800">Grammar Tip</span>
                            </div>
                            <p class="text-xs text-yellow-700">
                                <strong>Original:</strong> "I'd like to start by discussing the main ideas."<br>
                                <strong>Suggestion:</strong> "I'd like to start by discussing the main ideas." 
                                <span class="text-green-600">(Your sentence is grammatically correct! Well done!)</span>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- User Message -->
                <div class="flex items-start space-x-3 justify-end">
                    <div class="chat-bubble-user max-w-md p-4">
                        <p class="text-sm">What do you think about the role of teachers in this technological future?</p>
                    </div>
                    <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center flex-shrink-0">
                        <img 
                            src="https://s.coze.cn/image/ImRgvDeW_Cs/" 
                            alt="User Avatar" 
                            class="w-full h-full rounded-full object-cover"
                            data-category="人物"
                        >
                    </div>
                </div>

                <!-- AI Typing Indicator -->
                <div id="typing-indicator" class="flex items-start space-x-3 hidden">
                    <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-robot text-white text-sm"></i>
                    </div>
                    <div class="chat-bubble-ai p-4">
                        <div class="typing-indicator">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Action Buttons -->
            <div id="quick-actions" class="px-6 py-3 bg-gray-50 border-t border-border-light">
                <div class="flex flex-wrap gap-2">
                    <button id="quick-agree" class="quick-action-btn px-3 py-1 text-xs rounded-full">
                        I agree with that point
                    </button>
                    <button id="quick-disagree" class="quick-action-btn px-3 py-1 text-xs rounded-full">
                        I disagree because...
                    </button>
                    <button id="quick-question" class="quick-action-btn px-3 py-1 text-xs rounded-full">
                        Can you explain that further?
                    </button>
                    <button id="quick-example" class="quick-action-btn px-3 py-1 text-xs rounded-full">
                        Can you give an example?
                    </button>
                </div>
            </div>

            <!-- Message Input Area -->
            <div id="message-input-area" class="px-6 py-4 bg-white border-t border-border-light">
                <div class="flex items-end space-x-3">
                    <div class="flex-1">
                        <textarea 
                            id="message-input" 
                            placeholder="Type your message here..." 
                            rows="1"
                            class="w-full px-4 py-3 border border-border-light rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent resize-none"
                        ></textarea>
                    </div>
                    <button id="send-btn" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary hover:bg-opacity-90 transition-colors flex-shrink-0">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="flex items-center justify-between mt-3">
                    <div class="text-xs text-text-secondary">
                        <i class="fas fa-microphone mr-1"></i>
                        Voice input available
                    </div>
                    <button id="end-session-btn" class="px-4 py-2 text-sm text-red-600 border border-red-200 rounded-lg hover:bg-red-50 transition-colors">
                        <i class="fas fa-stop mr-2"></i>
                        End Session
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Material Info Drawer -->
    <div id="material-drawer" class="fixed inset-0 z-50 hidden">
        <div class="drawer-overlay absolute inset-0" id="material-drawer-overlay"></div>
        <div class="relative flex justify-end h-full">
            <div class="drawer-enter bg-white w-full max-w-md shadow-2xl">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-semibold text-text-primary">Material Information</h3>
                        <button id="material-drawer-close" class="text-text-secondary hover:text-text-primary">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <h4 class="text-sm font-medium text-text-secondary mb-1">Title</h4>
                            <p class="text-sm text-text-primary">The Future of Education</p>
                        </div>
                        
                        <div>
                            <h4 class="text-sm font-medium text-text-secondary mb-1">Index Code</h4>
                            <p class="text-sm text-text-primary">ENG-2025-U3-A</p>
                        </div>
                        
                        <div>
                            <h4 class="text-sm font-medium text-text-secondary mb-1">Version</h4>
                            <p class="text-sm text-text-primary">1.0</p>
                        </div>
                        
                        <div>
                            <h4 class="text-sm font-medium text-text-secondary mb-1">Upload Date</h4>
                            <p class="text-sm text-text-primary">March 15, 2024</p>
                        </div>
                        
                        <div>
                            <h4 class="text-sm font-medium text-text-secondary mb-1">Description</h4>
                            <p class="text-sm text-text-primary">An analysis of how emerging technologies are transforming traditional education models and the implications for future learning environments.</p>
                        </div>
                        
                        <div>
                            <h4 class="text-sm font-medium text-text-secondary mb-1">Estimated Reading Time</h4>
                            <p class="text-sm text-text-primary">15-20 minutes</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Session Summary Drawer -->
    <div id="summary-drawer" class="fixed inset-0 z-50 hidden">
        <div class="drawer-overlay absolute inset-0" id="summary-drawer-overlay"></div>
        <div class="relative flex justify-end h-full">
            <div class="drawer-enter bg-white w-full max-w-md shadow-2xl">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-semibold text-text-primary">Session Summary</h3>
                        <button id="summary-drawer-close" class="text-text-secondary hover:text-text-primary">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <h4 class="text-sm font-medium text-text-secondary mb-1">Session Duration</h4>
                            <p class="text-sm text-text-primary">25 minutes</p>
                        </div>
                        
                        <div>
                            <h4 class="text-sm font-medium text-text-secondary mb-1">Topics Discussed</h4>
                            <ul class="text-sm text-text-primary space-y-1">
                                <li>• Main ideas of the article</li>
                                <li>• Technological transformations in education</li>
                                <li>• Role of teachers in digital learning</li>
                            </ul>
                        </div>
                        
                        <div>
                            <h4 class="text-sm font-medium text-text-secondary mb-1">Strengths Noted</h4>
                            <div class="flex flex-wrap gap-2">
                                <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Good comprehension</span>
                                <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Clear expression</span>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-sm font-medium text-text-secondary mb-1">Areas to Improve</h4>
                            <div class="flex flex-wrap gap-2">
                                <span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full">Complex sentence structures</span>
                                <span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full">Vocabulary variety</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Parse URL parameters
            function getUrlParams() {
                const params = {};
                const queryString = window.location.search.substring(1);
                const urlParams = new URLSearchParams(queryString);
                
                for(const [key, value] of urlParams.entries()) {
                    params[key] = value;
                }
                return params;
            }

            // Get URL parameters and update material info
            const params = getUrlParams();
            if(params.material_code || params.material_id) {
                // In a real application, this would fetch material details from the server
                console.log('Material parameter received:', params);
            }

            // Auto-resize textarea
            const messageInput = document.querySelector('#message-input');
            messageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });

            // Send message function
            function sendMessage() {
                const input = document.querySelector('#message-input');
                const message = input.value.trim();
                
                if(message) {
                    // Add user message to chat
                    addUserMessage(message);
                    input.value = '';
                    input.style.height = 'auto';
                    
                    // Show typing indicator and simulate AI response
                    showTypingIndicator();
                    setTimeout(() => {
                        hideTypingIndicator();
                        generateAIResponse(message);
                    }, 1500 + Math.random() * 1000);
                }
            }

            // Add user message to chat
            function addUserMessage(message) {
                const chatMessages = document.querySelector('#chat-messages');
                const messageElement = document.createElement('div');
                messageElement.className = 'flex items-start space-x-3 justify-end';
                messageElement.innerHTML = `
                    <div class="chat-bubble-user max-w-md p-4">
                        <p class="text-sm">${message}</p>
                    </div>
                    <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center flex-shrink-0">
                        <img 
                            src="https://s.coze.cn/image/UV_WjWcZQIs/" 
                            alt="User Avatar" 
                            class="w-full h-full rounded-full object-cover"
                            data-category="人物"
                        >
                    </div>
                `;
                chatMessages.appendChild(messageElement);
                scrollToBottom();
            }

            // Add AI message to chat
            function addAIMessage(message, hasGrammarTip = false) {
                const chatMessages = document.querySelector('#chat-messages');
                const messageElement = document.createElement('div');
                messageElement.className = 'flex items-start space-x-3';
                
                let grammarTip = '';
                if(hasGrammarTip) {
                    grammarTip = `
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-3 rounded-r mt-2">
                            <div class="flex items-center space-x-2 mb-1">
                                <i class="fas fa-lightbulb text-yellow-600 text-sm"></i>
                                <span class="text-xs font-medium text-yellow-800">Grammar Tip</span>
                            </div>
                            <p class="text-xs text-yellow-700">
                                <strong>Original:</strong> "${message}"<br>
                                <strong>Suggestion:</strong> "${message}" 
                                <span class="text-green-600">(Great sentence structure!)</span>
                            </p>
                        </div>
                    `;
                }
                
                messageElement.innerHTML = `
                    <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-robot text-white text-sm"></i>
                    </div>
                    <div class="flex-1 max-w-md">
                        <div class="chat-bubble-ai p-4">
                            <p class="text-sm">${message}</p>
                        </div>
                        ${grammarTip}
                    </div>
                `;
                chatMessages.appendChild(messageElement);
                scrollToBottom();
            }

            // Generate AI response based on user message
            function generateAIResponse(userMessage) {
                const responses = [
                    "That's an excellent observation! The article indeed emphasizes that while technology provides powerful tools, teachers remain crucial for emotional support and critical thinking guidance. Would you like to explore specific examples from the text?",
                    "You're asking a very important question. According to the article, teachers are evolving from knowledge providers to learning facilitators. They help students navigate information and develop essential skills. What aspects of this role transition interest you most?",
                    "Great question! The future of teaching involves more personalized mentorship and less lecturing. Teachers will use technology to identify individual student needs while focusing on developing creativity and problem-solving abilities. How do you see this changing classroom dynamics?",
                    "Interesting perspective! The article suggests that technology can handle routine tasks like grading and content delivery, freeing teachers to focus on what machines can't do—building relationships and inspiring students. What challenges do you think teachers might face in this new role?",
                    "You're absolutely right to consider this! The material discusses how teachers will need continuous professional development to effectively integrate technology. They'll become guides who help students make sense of information overload. Would you like to discuss specific training approaches mentioned?"
                ];
                
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                const includeGrammarTip = Math.random() > 0.7;
                
                addAIMessage(randomResponse, includeGrammarTip);
                
                // Randomly trigger quiz (10% chance)
                if(Math.random() < 0.1) {
                    setTimeout(() => {
                        triggerQuiz();
                    }, 1000);
                }
            }

            // Show typing indicator
            function showTypingIndicator() {
                document.querySelector('#typing-indicator').classList.remove('hidden');
                scrollToBottom();
            }

            // Hide typing indicator
            function hideTypingIndicator() {
                document.querySelector('#typing-indicator').classList.add('hidden');
            }

            // Scroll to bottom of chat
            function scrollToBottom() {
                const chatMessages = document.querySelector('#chat-messages');
                setTimeout(() => {
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 100);
            }

            // Trigger quiz
            function triggerQuiz() {
                console.log('需要调用第三方接口实现小测功能');
                // In a real application, this would open the quiz modal or navigate to P-QUIZ
                alert('Great discussion! Let\'s test your understanding with a quick quiz. (Quiz functionality would open here)');
            }

            // Quick action buttons
            document.querySelector('#quick-agree').addEventListener('click', function() {
                document.querySelector('#message-input').value = "I agree with that point";
                document.querySelector('#message-input').style.height = 'auto';
                document.querySelector('#message-input').focus();
            });

            document.querySelector('#quick-disagree').addEventListener('click', function() {
                document.querySelector('#message-input').value = "I disagree because";
                document.querySelector('#message-input').style.height = 'auto';
                document.querySelector('#message-input').focus();
                document.querySelector('#message-input').setSelectionRange(16, 16);
            });

            document.querySelector('#quick-question').addEventListener('click', function() {
                document.querySelector('#message-input').value = "Can you explain that further?";
                document.querySelector('#message-input').style.height = 'auto';
                document.querySelector('#message-input').focus();
            });

            document.querySelector('#quick-example').addEventListener('click', function() {
                document.querySelector('#message-input').value = "Can you give an example?";
                document.querySelector('#message-input').style.height = 'auto';
                document.querySelector('#message-input').focus();
            });

            // Send button click event
            document.querySelector('#send-btn').addEventListener('click', sendMessage);

            // Enter key to send message (Shift+Enter for new line)
            document.querySelector('#message-input').addEventListener('keydown', function(e) {
                if(e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // End session button
            document.querySelector('#end-session-btn').addEventListener('click', function() {
                if(confirm('Are you sure you want to end this session? A learning report will be generated.')) {
                    // Simulate report generation
                    this.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating Report...';
                    this.disabled = true;
                    
                    setTimeout(() => {
                        window.location.href = 'P-REPORT.html?session_id=' + Date.now();
                    }, 2000);
                }
            });

            // Drawer functionality
            function openDrawer(drawerId) {
                const drawer = document.querySelector(`#${drawerId}`);
                const drawerContent = drawer.querySelector('.drawer-enter');
                
                drawer.classList.remove('hidden');
                setTimeout(() => {
                    drawerContent.classList.add('drawer-enter-active');
                }, 10);
                
                scrollToBottom();
            }

            function closeDrawer(drawerId) {
                const drawer = document.querySelector(`#${drawerId}`);
                const drawerContent = drawer.querySelector('.drawer-enter');
                
                drawerContent.classList.remove('drawer-enter-active');
                setTimeout(() => {
                    drawer.classList.add('hidden');
                }, 300);
            }

            // Material info drawer
            document.querySelector('#material-info-btn').addEventListener('click', function() {
                openDrawer('material-drawer');
            });

            document.querySelector('#material-drawer-close').addEventListener('click', function() {
                closeDrawer('material-drawer');
            });

            document.querySelector('#material-drawer-overlay').addEventListener('click', function() {
                closeDrawer('material-drawer');
            });

            // Session summary drawer
            document.querySelector('#session-summary-btn').addEventListener('click', function() {
                openDrawer('summary-drawer');
            });

            document.querySelector('#summary-drawer-close').addEventListener('click', function() {
                closeDrawer('summary-drawer');
            });

            document.querySelector('#summary-drawer-overlay').addEventListener('click', function() {
                closeDrawer('summary-drawer');
            });

            // Navigation events
            document.querySelector('#nav-dashboard').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'P-ENTRY.html';
            });

            document.querySelector('#nav-reports').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'P-REPORT.html';
            });

            // Initialize chat
            scrollToBottom();
        });
    </script>
</body>
</html>